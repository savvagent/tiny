var g=class{constructor(e,t={}){return this.ctx=t,this._path=[],this.parse(e)}append(e){return this._path.push(e),this.ctx}delete(e){return Array.isArray(e)?e.reverse().forEach(t=>this._path.splice(t,1)):Number.isInteger(e)?this._path.splice(e,1):this._path.pop(),this.ctx}get(){return this._path}parse(e=""){let t=decodeURIComponent(e),r=t.split("/");return Array.isArray(r)&&(t.match(/^\//)&&r.shift(),r[0]===""&&r.shift(),r.length>1&&t.match(/\/$/)&&r.pop(),this._path=r),this}replace(e,t){return t==="file"?(this._path.splice(this._path.length-1,1,e),this.ctx):Number.isInteger(t)?(this._path.splice(t,1,e),this.ctx):(this.parse(e),this.ctx)}toString(e){return e?this.ctx.toString():Array.isArray(this._path)?this._path.join("/"):""}},y=class{constructor(e,t={}){return Object.assign(this,t),this.ctx=t,this.set(e),this}add(e={}){return this._query=this._convert(e,this._query[0],this._query[1]),this.ctx}clear(){return this._query=[[],[]],this.ctx}_convert(e,t=[],r=[]){for(let s in e)if(Array.isArray(e[s]))for(let i=0;i<e[s].length;i++){let h=e[s][i];t.push(s),r.push(h)}else e[s]&&(t.push(s),r.push(e[s]));return[t,r]}get(e){let t={},r=this._query;for(let s=0;s<r[0].length;s++){let i=r[0][s],h=r[1][s];t[i]?t[i].push(h):t[i]=[h]}return e?t[e]&&t[e].length?t[e][0]:null:t}getUrlTemplateQuery(){return this._urlTemplateQueryString}merge(e){let t=this._query[0],r=this._query[1];for(let s in e){let i=!1;for(let h=0;h<t.length;h++){let n=t[h];if(s===n){if(i){t.splice(h,1),r.splice(h,1);continue}Array.isArray(e[s])?r[h]=e[s].shift():typeof e[s]>"u"||e[s]===null?(t.splice(h,1),r.splice(h,1),delete e[s]):(r[h]=e[s],delete e[s]),i=!0}}}return this._query=this._convert(e,this._query[0],this._query[1]),this.ctx}_parse(e=""){let t=[[],[]],r=e.split(/&|;/);for(let s=0;s<r.length;s++){let i=r[s].match(this.qRegEx);if(i&&typeof i[i.length-1]<"u"){i.shift();for(let h=0;h<i.length;h++){let n=i[h];t[h].push(decodeURIComponent(n.replace("+"," ","g")))}}}return t}set(...e){let t=[...e];if(t.length===1)typeof t[0]=="object"?this._query=this._convert(t[0]):this._query=this._parse(t[0]);else if(t.length===0)this.clear();else{let r={};r[t[0]]=t[1],this.merge(r)}return this.ctx}setUrlTemplateQuery(e){this._urlTemplateQueryString=e}toString(e){if(e)return this.ctx.toString();let t=[],r=this._query[0],s=this._query[1];for(let i=0;i<r.length;i++)t.push(encodeURIComponent(r[i])+"="+encodeURIComponent(s[i]));return t.join("&")}},f=typeof window<"u",a=f,l=e=>typeof e=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/.test(e);function d(e,t){return l(t)?new Date(t):l(e)?new Date(e):t}function m(e){try{return JSON.parse(e),!0}catch{return!1}}var _=e=>m(e)?JSON.parse(e,d):e,x=_,q=e=>JSON.stringify(e),o=q,S=class{constructor(){this.db=new Map}clear(){return this.db.clear()}del(e){return this.db.delete(e)}get(e){return this.db.get(e)}put(e,t){return this.set(e,t)}set(e,t){return this.db.set(e,t)}},w=class{constructor(){window.matchMedia("(display-mode: standalone)").matches?this.store=window.localStorage:this.store=window.sessionStorage}clear(){return this.store.clear()}del(e){return this.store.removeItem(e)}get(e){if(a)return x(this.store.getItem(e))}put(e,t){return this.store.setItem(e,o({...this.get(e),...t}))}set(e,t){return this.store.setItem(e,o(t))}},R=a?new w:new S,v=class{constructor(e){!e||typeof e>"u"?this.string="":this.string=String(e)}toString(){return this.string}append(e){return this.string+=e,this}insert(e,t){let r=this.string.length,s=this.string.slice(0,e),i=this.string.slice(e);return this.string=s+t+i,this}},E=a&&typeof navigator<"u"&&navigator.languages&&navigator.languages.length?navigator.languages[0]:"en",I=E.replace(/-.*/,""),p=class c{constructor(t){return this.uriRegEx=/^(([^:/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,this.authRegEx=/^([^@]+)@/,this.portRegEx=/:(\d+)$/,this.qRegEx=/^([^=]+)(?:=(.*))?$/,this.urlTempQueryRegEx=/\{\?(.*?)\}/,this.parse(t)}authority(t=""){if(t!==""){let i=t.match(this.authRegEx);this._authority=t,i&&(t=t.replace(this.authRegEx,""),this.userInfo(i[1]));let h=t.match(this.portRegEx);return h&&(t=t.replace(this.portRegEx,""),this.port(h[1])),this.host(t.replace("{","")),this}let r=this.userInfo();r&&(t=r+"@"),t=t+this.host();let s=this.port();return s&&(t=t+(":"+s)),t}fragment(t=""){return this.gs(t,"_fragment")}gs(t,r,s){return typeof t<"u"?(this[r]=t,this):s?s(this[r]):this[r]?this[r]:""}host(t){return this.gs(t,"_host")}parse(t){let r=t?t.match(this.uriRegEx):[],s=t?t.match(this.urlTempQueryRegEx):[];return this.scheme(r[2]),this.authority(r[4]),this.path=new g(r[5]?r[5].replace(/{$/,""):"",this),this.fragment(r[9]),this.query=new y(r[7]?r[7]:"",this),s&&this.query.setUrlTemplateQuery(s[1]),this}port(t){return this.gs(t,"_port")}protocol(t){return(this._scheme||"").toLowerCase()}scheme(t){return this.gs(t,"_scheme")}userInfo(t){return this.gs(t,"_userinfo",r=>r&&encodeURI(r))}toString(){let t=this.query.toString(),r=this.path.toString(),s=this.fragment(),i=this.scheme();return new v().append(i?i+"://":"").append(this.authority()).append("/").append(r).append(t!==""?"?":"").append(t).toString().replace("/?","?").replace(/\/$/,"")}static clone(t){return new c(t.toString())}};var u=class{constructor(t){return this.uri=new p(t),this.path=this.uri.path.get(),this.urlTemplateQuery=this.uri.query.getUrlTemplateQuery(),this}expand(t={}){return this.path.forEach((r,s)=>{let i=r.substring(r.lastIndexOf("{")+1,r.lastIndexOf("}"));i&&this.uri.path.replace(t[i],s)}),this.urlTemplateQuery&&this.urlTemplateQuery.split(",").forEach(s=>{if(typeof t[s]<"u"){let i={};i[s]=String(t[s]),this.uri.query.add(i)}}),this.template=this.uri.toString(),this}toString(){return this.template}};export{u as default};
//# sourceMappingURL=TinyUrlTemplate.js.map
