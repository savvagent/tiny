var c=t=>{try{if(JSON.parse(t))return!0}catch{return!1}};function _(t){let e=!1;return t==null||typeof t=="string"&&t===""?e=!0:t instanceof Date?e=!1:((Array.isArray(t)||typeof t=="string")&&t.length<1||typeof t=="string"&&!/\S/.test(t)||typeof t=="object"&&Object.keys(t).length<1||typeof t=="number"&&t===0)&&(e=!0),e}function d(t){return!_(t)}var h=t=>t instanceof Request?t:new Request(t),o=(t,e)=>{let{url:r}=e;return new Request(r,{...e,method:t})};var u=class{constructor(e=[],r){let s=typeof fetch=="function"&&typeof window<"u"?fetch.bind(window):typeof globalThis<"u"?fetch.bind(globalThis):r;this.cache=new Map,this.interceptors=[...e],this.requestPromise=null,this.requestMap=new Map,this.fetch=s}clear(){this.interceptors=[]}interceptor(e){let r=Promise.resolve(e);return this.interceptors.forEach(({request:s,requestError:n})=>{(s||n)&&(r=r.then(m=>s(m),n))}),r=r.then(s=>this.fetch(s)),this.interceptors.forEach(({response:s,responseError:n})=>{(s||n)&&(r=r.then(s,n))}),r}register(e,r){if(Array.isArray(e))this.interceptors=[...this.interceptors,...e];else{let s=Boolean(this.interceptors.find(n=>n.id===e.id));r!=="undefined"&&!s?this.interceptors.splice(r,0,e):s||(this.interceptors=[...this.interceptors,e])}}request(e){let r=h(e),s=JSON.stringify({url:r.url,method:r.method,...r.body&&c(r.body)&&{body:JSON.stringify(r.body)}});return this.cache.has(s)?this.cache.get(s):(this.cache.set(s,this.interceptor(r).finally(()=>this.cache.delete(s))),this.cache.get(s))}delete(e){let r=h(e),s=o("DELETE",r);return this.request(s)}get(e){let r=h(e),s=o("GET",r);return this.request(s)}head(e){let r=h(e),s=o("HEAD",r);return this.request(s)}patch(e){let r=h(e),s=o("PATCH",r);return this.request(s)}post(e){let r=h(e),s=o("POST",r);return this.request(s)}put(e){let r=h(e),s=o("PUT",r);return this.request(s)}unregister(e){this.interceptors=this.interceptors.filter(r=>r.id!==e)}get interceptors(){return this._interceptors}set interceptors(e){this._interceptors=e}},y=u;var x={request(t){return t.headers.set("Content-Type","application/json"),t.headers.set("Accept","application/json"),d(t.body)&&c(t.body)&&(t.body=JSON.stringify(t.body)),t},id:"TINY_FETCH_JSON_REQUEST"},f=x;var E={async response(t){if(t.bodyUsed)return t;try{let e=await t.text();return{...t,...JSON.parse(e)}}catch{return t}},id:"TINY_FETCH_JSON_RESPONSE"},l=E;var q={response(t){if(c(t))return t;if(!t.ok)throw t;return t},id:"TINY_FETCH_REJECT_ERRORS"},a=q;var p=new Map,R=1e3*60*10,i={id:"TINY_FETCH_LRUCACHE"};i.mapKey=null;i.request=t=>{if(t.cache){let{headers:e,url:r}=t,n=[...e.values()].join("");i.mapKey=JSON.stringify({url:r,method:t.method,headerString:n})}return t};i.response=t=>{if(i.mapKey){if(p.has(i.mapKey))return p.get(i.mapKey);p.set(i.mapKey,t.clone()),setTimeout(()=>{p.delete(i.mapKey)},R)}return t};var g=i;function S(t={}){return new y(f,l,a,g).request(t)}export{S as default};
//# sourceMappingURL=useTinyFetch.js.map
